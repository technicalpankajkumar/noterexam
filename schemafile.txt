-- Run this in Supabase SQL editor
create table profiles (
  id uuid primary key references auth.users(id) on delete cascade,
  email text not null,
  name text not null,
  mobile text not null,
  image text,
  course text,
  branch text,
  college text,
  university text,
  course_year text,
  created_at timestamp with time zone default timezone('utc'::text, now())
);

alter table profiles enable row level security;

-- Allow users to select/update their own profile
create policy "Users can view their own profile" on profiles
  for select using (auth.uid() = id);

create policy "Users can update their own profile" on profiles
  for update using (auth.uid() = id);

create policy "Users can insert their own profile" on profiles
  for insert with check (auth.uid() = id);


-- Allow authenticated users to upload and read their own files
create policy "Authenticated users can access their images" on storage.objects
  for all
  using (
    bucket_id = 'profile-images'
    AND auth.role() = 'authenticated'
  );

  -- Allow authenticated users to upload
CREATE POLICY "Allow uploads"
ON storage.objects
FOR INSERT
TO authenticated
WITH CHECK (bucket_id = 'doc');
